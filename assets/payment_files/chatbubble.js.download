"use strict";var fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var s,c={EVENT_USER_CALL_INCOMING:"user_call_incoming",EVENT_USER_CALL_ACCEPTED:"user_call_accepted",EVENT_USER_CALL_REJECTED:"user_call_rejected",EVENT_USER_CALL_DISCONNECT_SELF:"user_call_disconnect_self",EVENT_USER_CALL_DISCONNECT_SERVER:"user_call_disconnect_server",EVENT_USER_CALL_CONNECTION_ESTABLISHED:"user_call_connection_established",EVENT_USER_CALL_CONNECTION_CLOSED:"user_call_connection_closed",EVENT_USER_CALL_CONNECTION_FAILED:"user_call_connection_failed"};function a(e,t){var n,a=e&&e.lineno||"0",o=e&&e.colno||"0",i="["+(e&&e.filename||"unknown-file")+":"+a+":"+o+"] "+(e&&e.message||"null");n={eventName:"exception",details:{description:i,fatal:t||!1},isException:!0},D(A.ReportGoogleAnalyticsEvent,n),console.debug(new Date+" "+i)}window.dataLayer=window.dataLayer||[];var e,r,d={},t="data-unreadcount",u="kenytCallRinger",m="kenytIncomingCall",g={LOCAL:"/ChatbotUI/audio/incoming_call.mp3",PROD:"https://www.kenyt.ai/botapp/ChatbotUI/audio/incoming_call.mp3"},f=document.getElementById("kenytChatBubble"),p=document.getElementById("chatbox-container"),n=!1,o=0<window.location.href.indexOf("ampframe.html"),v=' \n    <div class="kenyt-media-container">\n        <video id="local" autoplay playsinline muted></video>\n        <div class="action-bar w-100">\n            <button class="call-action bg-green" id="call-start" title="Start call"><i class="fas fa-phone rotate-135"></i></button>\n            <button class="call-action bg-green" id="call-accept" title="Accept call"><i class="fas fa-phone"></i></button>\n            <button class="call-action bg-white" id="call-microphone-toggle" data-isenabled="true" title="Toggle microphone"><i class="fas fa-microphone"></i></button>\n            <button class="call-action bg-red" id="call-end" title="End call"><i class="fas fa-phone rotate-225"></i></button>\n            <button class="call-action bg-white" id="call-video-toggle" data-isenabled="true" title="Toggle video"><i class="fas fa-video"></i></button>\n            <button class="call-action bg-white" id="call-camera-toggle" data-isenabled="false" title="Toggle camera"><i class="fas fa-retweet"></i></button>\n            <button class="call-action bg-red" id="call-screenshare-toggle" data-isenabled="false" title="Toggle screen share"><i class="fas fa-desktop"></i></button>\n            <div class="float-right m-2 mr-3">\n                <button class="call-action bg-white" id="call-fullscreen-toggle" data-isfullscreen="false" title="Toggle fullscreen"><i class="fas fa-expand-arrows-alt"></i></button>\n            </div>\n        </div>\n        <video id="remote" autoplay playsinline></video>\n    </div>',y='\n    <div class="incoming-call text-center py-4">\n        <p>\n            <i class="fas fa-phone-volume fa-3x fa-inverse incoming-call-icon text-success"></i> \n            <span class="incoming-call-text ml-2">Incoming Call</span>\n        </p>\n        <div class="incoming-call-action text-left" id="accept-video-call">\n            <button class="call-action bg-green text-white"><span class="fas fa-video"></span></button>\n            <span>Accept</span>\n        </div>\n        <div class="incoming-call-action text-left" id="reject-call">\n            <button class="call-action bg-danger text-white"><span class="fas fa-phone rotate-225"></span></button>\n            <span>Dismiss</span>\n        </div>\n    </div>\n    ',h="kenyt-highlightArea",C='\n        <div class="kenyt-highlightArea"></div>\n    ',E=(document&&document.querySelector(".chatWithUsMessage"),"__kenytsession__"),i=new Date,b=0,S={audio:{echoCancellation:!0,noiseSuppression:!0},video:{facingMode:"user"}},L={audio:{echoCancellation:!0,noiseSuppression:!0},video:{facingMode:"environment"}},l={iceServers:[{urls:["stun:bn-turn1.xirsys.com"]},{username:"4Ts0wdSOWv7YcYBEli_S3pJfs7xktfm-ZMxmJ8zQxvcQeu0zvMvUFmepCr3i4t8uAAAAAF6lNP9rZW55dGluYw==",credential:"aae708e6-878d-11ea-b80d-9646de0e6ccd",urls:["turn:bn-turn1.xirsys.com:80?transport=udp","turn:bn-turn1.xirsys.com:3478?transport=udp","turn:bn-turn1.xirsys.com:80?transport=tcp","turn:bn-turn1.xirsys.com:3478?transport=tcp","turns:bn-turn1.xirsys.com:443?transport=tcp","turns:bn-turn1.xirsys.com:5349?transport=tcp"]}]},w=4e3,A={UnreadMessage:"kenytUnreadMessage",ChatWindowClose:"kenytChatWindowClose",ChatWindowOpen:"kenytChatWindowOpen",FullScreenImage:"kenytFullScreenImage",NavigateToPage:"kenytNavigateToPage",ToggleFullScreen:"kenytToggleFullscreen",ForceFullHeight:"kenytForceFullHeight",TextColor:"kenytTextColor",IsWindowMinimizedResponse:"kenytIsWindowMinimizedResponse",GetPageTitle:"kenytPageTitle",GetReferrer:"kenytPageReferrer",Initialize:"kenytInitialize",PageInfoRequest:"kenytPageInfoRequest",PageInfoResponse:"kenytPageInfoResponse",CustomEventDispatch:"kenytCustomEventDispatch",SettingsUpdate:"kenytSettingsUpdate",UpdateChatBubbleColor:"kenytUpdateChatBubbleColor",UpdateBotPosition:"kenytUpdateBotPosition",MediaStreamingCommand:"kenytMediaStreamingCommand",SendMessage:"kenytSendMessage",ReportGoogleAnalyticsEvent:"reportGoogleAnalyticsEvent"},k={center:"position-center",left:"position-left",right:"position-right"},T=function(){var e="__feature_test";try{return window.sessionStorage.setItem(e,e),window.sessionStorage.removeItem(e),!0}catch(e){return!1}}();function _(){e&&window.clearInterval(e),p&&(p.classList.remove("k-hide"),f.classList.add("k-hide")),D(A.IsWindowMinimizedResponse,!1),f.removeEventListener("click",_),f.addEventListener("click",I),f.hasAttribute(t)&&f.removeAttribute(t),M()}function I(){if(document.querySelector("#chatbox-container")&&(p.classList.add("k-hide"),f.classList.remove("k-hide")),D(A.IsWindowMinimizedResponse,!0),n){var e=f.querySelector(".chatWithUsMessage");e&&(e.style.display="none")}f.removeEventListener("click",I),f.addEventListener("click",_),M()}function N(e,t){R(e,+e.getAttribute("current-slide-number")+ +t)}function R(e,t){if(e){var n=e.getElementsByClassName("img-card");t>n.length?t=1:t<1&&(t=n.length);for(var a=0;a<n.length;a++)n[a].style.display="none";n[t-1].style.display="flex",e.setAttribute("current-slide-number",t)}}function x(){p&&p.classList.contains("full-height")&&p.classList.remove("full-height")}function M(){if(o){var e=document.querySelector("#chatbox-container"),t=100,n=100;"none"===e.style.display?n=t=100:e.classList&&(n=e.classList.contains("k-hide")?t=100:e.classList.contains("force-fullscreen")?t=1e3:e.classList.contains("full-height")?(t=370,1e3):navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)?(t=370,350):(t=370,470)),t&&100<=t&&n&&100<=n&&window.parent.postMessage({sentinel:"amp",type:"embed-size",width:t,height:n},"*")}}function D(e,t){var n=document.querySelector("#kenytChatWindow").contentWindow;if(n){var a={type:e,value:t};n.postMessage(a,"*")}else console.warn("[Kenyt.AI] Iframe load error")}function P(){return{PageTitle:document.title,PageUrl:window.location.href,StartTime:i,SessionId:r}}function O(){var e=window.location.search;return e&&(e=e.substring(1)),{SessionId:r,Updated:!1,FirstPageQueryPrm:e,History:[P()]}}function U(e){return e&&"string"==typeof e&&0<e.trim().length}function B(e){var t=null;if(T){var n=window.localStorage.getItem(e);U(n)&&(t=JSON.parse(n))}return t}function q(e,t){T&&U(e)&&t&&window.localStorage.setItem(e,JSON.stringify(t))}function W(e){console.error(e),e&&(e.message=e.message||"",e.message="Handle Error: "+e.message),a(e,!0)}function H(e,t,n){var a={Type:e,Command:t,Data:n},o=JSON.parse(JSON.stringify(a));console.log("Outgoing Signal : ",o),D(A.MediaStreamingCommand,o)}function V(){console.log("closeIncomingCallPopup");var e,t=document.getElementById(m);t&&t.remove(),e=document.getElementById(u),window.setTimeout(function(){e.pause()},0)}function F(e){if(console.log("showCallPopup",e),!document.querySelector(".kenyt-media-container")){var t=K(v);(d=d||{}).endCallButton=t.querySelector("button#call-end"),d.startCallButton=t.querySelector("button#call-start"),d.acceptCallButton=t.querySelector("button#call-accept"),d.localMediaElement=t.querySelector("video#local"),d.remoteMediaElement=t.querySelector("video#remote"),d.showReject=t.querySelector("button#call-reject"),d.startCallButton.addEventListener("click",function(){ee()}),d.endCallButton.addEventListener("click",function(){D(A.ReportGoogleAnalyticsEvent,{eventName:c.EVENT_USER_CALL_DISCONNECT_SELF,isException:!1}),Z("Ending call",!0,!1,!1),ce(),H("MediaPlayer","EndCall",""),ue()}),d.acceptCallButton.addEventListener("click",function(){te()});var n=t.querySelector("#call-fullscreen-toggle"),a=t.querySelector("#call-microphone-toggle"),i=t.querySelector("#call-video-toggle"),l=t.querySelector("#call-screenshare-toggle");navigator.mediaDevices&&"getDisplayMedia"in navigator.mediaDevices||l.setAttribute("hidden","true");var s=t.querySelector("#call-camera-toggle");navigator.mediaDevices.enumerateDevices().then(function(e){var t=0;e.forEach(function(e){"videoinput"===e.kind&&t++}),b=t,console.log("number of cameras",b),1<b?Y(s):X(s)}),console.log(s),!1===d.mediaContraints.video&&(i.classList.remove("bg-white"),i.querySelector("i").classList.remove("fa-video"),i.classList.add("bg-red"),i.querySelector("i").classList.add("fa-video-slash"),i.setAttribute("data-isenabled","false")),n.addEventListener("click",function(){"true"===n.getAttribute("data-isfullscreen")?(t.classList.remove("fullscreen"),n.querySelector("i").classList.remove("fa-compress"),n.querySelector("i").classList.add("fa-expand-arrows-alt"),n.setAttribute("data-isfullscreen","false"),ge(t)):(t.classList.add("fullscreen"),n.querySelector("i").classList.remove("fa-expand-arrows-alt"),n.querySelector("i").classList.add("fa-compress"),n.setAttribute("data-isfullscreen","true"),t.onmousedown=null)}),a.addEventListener("click",function(){"true"===a.getAttribute("data-isenabled")?(a.classList.remove("bg-white"),a.querySelector("i").classList.remove("fa-microphone"),a.classList.add("bg-red"),a.querySelector("i").classList.add("fa-microphone-slash"),a.setAttribute("data-isenabled","false"),d.localUserStream.getAudioTracks().forEach(function(e){return e.enabled=!1})):(a.classList.remove("bg-red"),a.querySelector("i").classList.remove("fa-microphone-slash"),a.classList.add("bg-white"),a.querySelector("i").classList.add("fa-microphone"),a.setAttribute("data-isenabled","true"),d.localUserStream.getAudioTracks().forEach(function(e){return e.enabled=!0}))}),i.addEventListener("click",function(){var e=i.getAttribute("data-isenabled"),t=l.getAttribute("data-isenabled");"true"===e?(i.classList.remove("bg-white"),i.querySelector("i").classList.remove("fa-video"),i.classList.add("bg-red"),i.querySelector("i").classList.add("fa-video-slash"),i.setAttribute("data-isenabled","false"),G(),"true"===t&&J(l)):(i.classList.add("bg-white"),i.querySelector("i").classList.add("fa-video"),i.classList.remove("bg-red"),i.querySelector("i").classList.remove("fa-video-slash"),i.setAttribute("data-isenabled","true"),j(),z(),me())}),s.addEventListener("click",function(){var e,t,n=s.getAttribute("data-isenabled"),a=i.getAttribute("data-isenabled"),o=l.getAttribute("data-isenabled");n="true"===n?(s.setAttribute("data-isenabled","false"),"false"):(s.setAttribute("data-isenabled","true"),"true"),e=n,t=o,"true"===a&&"false"===t&&(d.localUserStream.getVideoTracks().forEach(function(e){e.stop()}),d.mediaContraints="true"===e?L:S,navigator.mediaDevices.getUserMedia(d.mediaContraints).then(function(e){e&&Q(e)}).catch(W))}),l.addEventListener("click",function(){var e=i.getAttribute("data-isenabled");"true"===l.getAttribute("data-isenabled")?(l.classList.remove("bg-white"),l.classList.add("bg-red"),l.setAttribute("data-isenabled","false"),z(),H("MediaPlayer","DisableAgentScreenHighlight",""),"true"===e&&j()):(l.classList.add("bg-white"),l.classList.remove("bg-red"),l.setAttribute("data-isenabled","true"),J(l),G())}),me(),Z("",!0,!1,!1),document.body.appendChild(t),ge(t)}}function G(){d.localUserStream.getVideoTracks().forEach(function(e){return e.enabled=!1}),X()}function j(){Q(d.localUserStream),Y()}function z(){d.localDisplayStream&&(d.localDisplayStream.getTracks().forEach(function(e){return e.stop()}),d.localDisplayStream=null),Y(),me()}function J(t){navigator.mediaDevices.getDisplayMedia().then(function(e){d.localDisplayStream=e;d.localDisplayStream.oninactive=function(e){return function(e,t){if(console.log("Screen share inactive"),t){var n=t.getAttribute("data-isenabled");"true"===n&&t.click()}}(0,t)},Q(d.localDisplayStream),console.log("Enable Agent Highlight"),H("MediaPlayer","EnableAgentScreenHighlight","")}).catch(function(e){e.message=e.message||"",e.message="Screen Sharing: "+e.message,a(e.message,!1),console.log("Error in displaying media",e);var t=document.getElementById("call-screenshare-toggle"),n=document.getElementById("call-video-toggle").getAttribute("data-isenabled");t.classList.remove("bg-white"),t.classList.add("bg-red"),t.setAttribute("data-isenabled","false"),z(),"true"===n&&j()}),X()}function Y(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;e||(e=K(v).querySelector("#call-camera-toggle"));1<b&&(console.log("Enabling camera button"),e.removeAttribute("hidden"))}function X(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;e||(e=K(v).querySelector("#call-camera-toggle"));console.log("Disbabling camera button"),e.setAttribute("hidden","true")}function Q(e){e.getVideoTracks().forEach(function(e){return e.enabled=!0}),d.localMediaElement.srcObject=e;for(var t=0;t<d.senders.length;t++){var n=d.senders[t];if(n&&n.track&&"video"===n.track.kind){n.replaceTrack(e.getVideoTracks()[0]);break}}}function K(e){e=e.trim();var t=document.createElement("template");return t.innerHTML=e,t.content.firstChild}function Z(e,t,n,a,o){console.log("updateMediaStreamingPopup"),d&&(d.messageBox&&(d.messageBox.innerText=e),d.startCallButton&&(t?(d.startCallButton.disabled=!1,d.startCallButton.classList.remove("k-hide")):(d.startCallButton.disabled=!0,d.startCallButton.classList.add("k-hide"))),d.acceptCallButton&&(n?(d.acceptCallButton.disabled=!1,d.acceptCallButton.classList.remove("k-hide")):(d.acceptCallButton.disabled=!0,d.acceptCallButton.classList.add("k-hide"))),d.endCallButton&&(a?(d.endCallButton.disabled=!1,d.endCallButton.classList.remove("k-hide")):(d.endCallButton.disabled=!0,d.endCallButton.classList.add("k-hide"))))}function ee(){Z("Waiting for agent to accept",!1,!1,!0),H("MediaPlayer","StartCall","")}function te(){D(A.ReportGoogleAnalyticsEvent,{eventName:c.EVENT_USER_CALL_ACCEPTED,isException:!1}),Z("Thanks for accepting, connecting with agent",!1,!1,!0),H("MediaPlayer","AcceptCall","")}function ne(){if(console.log("initializePeerConnection"),!d.peerConnection)try{var e=new RTCPeerConnection(l);e.onicecandidate=ae,e.onnegotiationneeded=function(){console.log("creating offer"),e.createOffer().then(se).catch(W)},e.ontrack=oe,d.peerConnection=e,D(A.ReportGoogleAnalyticsEvent,{eventName:c.EVENT_USER_CALL_CONNECTION_ESTABLISHED,isException:!1})}catch(e){console.log("Failed to initialize RTC Peer connection"),W(e),D(A.ReportGoogleAnalyticsEvent,{eventName:c.EVENT_USER_CALL_CONNECTION_FAILED,isException:!1})}}function ae(e){(console.log("handleICECandidate"),console.log("icecandidate event: ",e),e.candidate)?H("WebRtc","",{type:"candidate",data:e.candidate}):console.log("End of candidates.")}function oe(e){console.log("handleRemoteStreamAdded",e),d.remoteMediaElement&&(d.remoteMediaElement.srcObject=e.streams[0],console.log("Remote stream added to remote media element"),d.remoteMediaElement.autoplay=!0,d.remoteMediaElement.playsInline=!0,e.streams.forEach(function(e){e.onremovetrack=ie,console.log("remote track ",e)}))}function ie(e){console.log("Remote stream removed. Event: ",e)}function le(t){console.log("saveMediaAndAddTracks"),d.localMediaElement.srcObject=t,ne(),d.senders||(d.senders=[]),t.getTracks().forEach(function(e){d.senders.push(d.peerConnection.addTrack(e,t)),console.log("local track ",e)})}function se(e){console.log("setLocalAndSendOffer"),d.peerConnection.setLocalDescription(e),console.log("setLocalAndSendMessage sending message",e),H("WebRtc","",e)}function ce(){if(console.log("stopPeerConnection"),d.peerConnection&&(d.peerConnection.getSenders().forEach(function(e){d.peerConnection.removeTrack(e)}),d.peerConnection.close(),d.peerConnection=null),d.localMediaElement&&re(d.localMediaElement),d.remoteMediaElement&&re(d.remoteMediaElement),de(d.localUserStream),de(d.localDisplayStream),Z("Call disconnected",!0,!1,!1),D(A.ReportGoogleAnalyticsEvent,{eventName:c.EVENT_USER_CALL_CONNECTION_CLOSED,isException:!1}),s){var e=((new Date).valueOf()-s.valueOf())/1e3;console.log("Call duration in seconds = "+e)}}function re(e){(console.log("stopStreamedVideo"),e&&e.srcObject)&&(e.srcObject.getTracks().forEach(function(e){e.stop()}),e.srcObject=null)}function de(e){console.log("stopping streams"),e&&e.getTracks().forEach(function(e){return e.stop()})}function ue(){console.log("closeCallPopup");var e=document.querySelector(".kenyt-media-container");e&&e.remove()}function me(){console.log("Removing highlight area");var e=document.getElementById(h);e&&e.remove()}function ge(t){var n=0,a=0,o=0,i=0;function l(e){(e=e||window.event).preventDefault(),n=o-e.clientX,a=i-e.clientY,o=e.clientX,i=e.clientY,t.style.top=t.offsetTop-a+"px",t.style.left=t.offsetLeft-n+"px"}function s(){document.onmouseup=null,document.onmousemove=null}t.onmousedown=function(e){(e=e||window.event).preventDefault(),o=e.clientX,i=e.clientY,document.onmouseup=s,document.onmousemove=l}}f&&f.addEventListener("click",_),window.addEventListener("click",function(){x()}),window.addEventListener("touchstart",function(){x()}),window.addEventListener("message",function(e){if("object"===fe(e.data)&&e.data.type){var t=e.data;if(t.type===A.ChatWindowOpen)_();else if(t.type===A.ChatWindowClose)I();else if(t.type===A.ToggleFullScreen)!function(e){var t=document.querySelector("#chatbox-container");e&&t&&("maximize"===e?t.classList.add("force-fullscreen"):"minimize"===e&&t.classList.remove("force-fullscreen"));M()}(t.value);else if(t.type===A.ForceFullHeight)!function(){p&&!p.classList.contains("force-fullscreen")&&p.classList.add("full-height");M()}();else if(t.type===A.FullScreenImage)!function(l){var e=document.querySelector("body"),s=document.createElement("div");s.classList.add("kenyt-fullscreen-container"),s.setAttribute("current-slide-number",l.currentSlideNumber);var t=document.createElement("div");t.classList.add("next","navigation"),t.addEventListener("click",function(){N(s,1)}),t.textContent="❯";var n=document.createElement("div");n.classList.add("prev","navigation"),n.addEventListener("click",function(){N(s,-1)}),n.textContent="❮";var a=document.createElement("span");a.innerHTML="&times;",a.classList.add("kenyt-popup-close"),a.addEventListener("click",function(){o()}),s.appendChild(n),s.appendChild(t);var c=1;function o(){var e=document.querySelector(".kenyt-fullscreen-container");e&&e.remove(),document.removeEventListener("keyup",i)}l.slides.forEach(function(e){var t=document.createElement("div");t.classList.add("img-card");var n=document.createElement("div");n.classList.add("numberText","text"),n.textContent=c+"/"+l.slides.length;var a=document.createElement("div");a.classList.add("img-container");var o=document.createElement("img");o.src=e.imageUrl;var i=document.createElement("div");i.classList.add("captionText","text"),i.textContent=e.caption,a.appendChild(o),t.appendChild(n),t.appendChild(a),t.appendChild(i),s.appendChild(t),c++}),s.appendChild(a),R(s,l.currentSlideNumber),e.appendChild(s),document.addEventListener("keyup",i),document.activeElement&&document.activeElement.blur();function i(e){27===e.keyCode?o():37===e.keyCode?N(s,-1):39===e.keyCode&&N(s,1)}document.focus()}(t.value);else if(t.type===A.NavigateToPage){var n=t.value;!function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e?t?window.location.href=e:window.open(e,"_blank"):console.warn("[Kenyt.AI] Cannot navigate to page - Invalid URL")}(n.url,n.openInSamePage||!1)}else if(t.type===A.TextColor)f.style.color=t.value||f.style.color;else if(t.type===A.Initialize)r=t.value,function(){var e=B(E);if(e)if(e.SessionId===r){if(e.Updated)return console.debug("Tracking data already sent");e.History||(e.History=[]),e.History.push(P())}else e=O();else e=O();q(E,e)}(),D(A.GetPageTitle,document.title||""),D(A.GetReferrer,document.referrer||"");else if(t.type===A.PageInfoRequest)!function(){var e=B(E);e||(e=O());void 0!==e.History&&0<e.History.length&&D(A.PageInfoResponse,e.History);e.Updated=!0,e.History=[],q(E,e)}();else if(t.type===A.CustomEventDispatch){var a=t.value;if(a){var o=new CustomEvent("kenytEvent",{detail:{eventType:a.EventName||null,data:a.EventData||null},bubbles:!0});document.dispatchEvent(o)}}else if(t.type===A.UpdateChatBubbleColor){if(t.value){var i=f.getElementsByClassName("kprimary-bg");Array.from(i).forEach(function(e){e.style.backgroundColor=t.value}),i=f.getElementsByClassName("kprimary-color"),Array.from(i).forEach(function(e){e.style.color=t.value}),i=f.getElementsByClassName("kprimary-border"),Array.from(i).forEach(function(e){e.style.borderColor=t.value})}}else if(t.type===A.UpdateBotPosition&&t.value){var l=t.value.toLowerCase();k[l]&&(Object.keys(k).forEach(function(e){f.classList.remove(k[e]),p.classList.remove(k[e])}),f.classList.add(k[l]),p.classList.add(k[l]))}else t.type===A.MediaStreamingCommand&&function(e){console.log("handleMediaStreamingCommand");var t=JSON.parse(JSON.stringify(e));console.log("Incoming Signal : ",t),"MediaPlayer"===e.Type?(a=e,console.log("handleMediaPlayerCommands",a),console.log("command: "+(a.Command||"<empty>")),"OpenMediaPlayer"===a.Command?(F(a.Data),H("Log","OpenMediaPlayerCommand Executed","")):"CloseMediaPlayer"===a.Command?(function(){console.log("closeCallPopup"),ce();var e=document.querySelector(".kenyt-media-container");e&&e.remove()}(),H("Log","CloseMediaPlayerCommand Executed","")):"StartCall"===a.Command?(F(a.Data),H("Log"," Executed","")):"AcceptCall"===a.Command?H("Log","AcceptCallCommand Executed",""):"EndCall"===a.Command?(ce(),ue(),H("Log","End Call Command Executed","")):"ScreenHighlightStarted"===a.Command?(o=a.Data,console.log("highlighting screen",o),function(e){console.log("Adding highlight area");var t=K(C);if(t.setAttribute("id",h),t&&t.style){var n=window.screen.availHeight,a=window.screen.availWidth,o=n/e.WindowHeight,i=a/e.WindowWidth,l=o*e.Top;e.IsFullScreen||e.Bottom,t.style.left=i*e.Left+"px",t.style.right=i*e.Right+"px",t.style.height=o*e.Height+"px",t.style.width=i*e.Width+"px",t.style.top=l+"px",t.style.X=i*e.X,t.style.Y=o*e.Y,t.style.visibility="visible",document.body.appendChild(t)}}(o)):"ScreenHighlightEnded"===a.Command&&(console.log("highlight screen ended"),me())):"WebRtc"===e.Type?function(e){if("answer"===e.type)console.log("received answer"),ne(),d.peerConnection&&(console.log("setting remote description"),d.peerConnection.setRemoteDescription(e).then(function(){console.log("remote description set successfully")}).catch(function(){console.log("remote description set failed")}));else if("candidate"===e.type&&(ne(),d.peerConnection)){var t=new RTCIceCandidate({sdpMLineIndex:e.data.sdpMLineIndex,candidate:e.data.candidate});d.peerConnection.addIceCandidate(t)}if("offer"===e.type&&(ne(),d.peerConnection)){navigator.mediaDevices.getUserMedia(d.mediaContraints).then(function(e){d.localUserStream=e}),le(d.localUserStream),d.peerConnection.setRemoteDescription(new RTCSessionDescription(e)),console.log("creating answer");d.peerConnection.createAnswer({offerToReceiveVideo:!0,offerToReceiveAudio:!0}).then(function(e){console.log("created answer successfully"),d.peerConnection.setLocalDescription(e),H("WebRtc","",e)}).catch(this.handleError),this.state="Connected with user"}}(e.Data):"Broadcast"===e.Type?function(e){if("IncomingCall"===e.Command)!function(){console.log("showIncomingCallPopup");var e=K(y);e.setAttribute("id",m),e.querySelector("#accept-video-call").addEventListener("click",function(){V(),d.mediaContraints=S,F(null),te(),s=new Date}),e.querySelector("#reject-call").addEventListener("click",function(){V(),Z("Rejected the call with agent",!1,!1,!0),D(A.ReportGoogleAnalyticsEvent,{eventName:c.EVENT_USER_CALL_REJECTED,isException:!1}),H("MediaPlayer","RejectCall",""),console.log("Rejected Call")}),document.body.appendChild(e),function(){var e=document.getElementById(u);e||(e=function(){var e=document.createElement("audio");e.setAttribute("preload","auto"),e.setAttribute("autobuffer",""),e.setAttribute("loop",""),e.setAttribute("id",u);var t=document.createElement("source");return t.src=(n=window.location.href,0<=n.indexOf("http://localhost")||n.startsWith("file:///")||0<=window.location.href.indexOf("ngrok.io")?g.LOCAL:g.PROD),e.appendChild(t),document.body.appendChild(e),e;var n}());window.setTimeout(function(){e.currentTime=0,e.play()},0)}()}(),D(A.ReportGoogleAnalyticsEvent,{eventName:c.EVENT_USER_CALL_INCOMING,isException:!1});else if("CallAccepted"===e.Command)Z("Call Accepted",!1,!1,!0);else if("InitiateMediaConnection"===e.Command){if(d&&(ne(),d.peerConnection))try{navigator.mediaDevices.getUserMedia(d.mediaContraints).then(function(e){d.localUserStream=e,le(d.localUserStream)})}catch(e){W(e)}Z("Initiating Connection",!1,!1,!0)}else"CallDisconnected"!==e.Command&&"CallMissed"!==e.Command||(D(A.ReportGoogleAnalyticsEvent,{eventName:c.EVENT_USER_CALL_DISCONNECT_SERVER,isException:!1}),ce(),V(),Z(e.Command,!0,!1,!1),setTimeout((ue(),void H("MediaPlayer","CloseMediaPlayer","")),w))}(e):"UserChat"===e.Type&&"StartCall"===(n=e).Command&&(console.log("User wants to start call from chat"),F(n.data),ee());var n;var a,o}(t.value)}},!1),M()}();